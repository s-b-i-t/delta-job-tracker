spring:
  datasource:
    url: ${DB_URL:jdbc:postgresql://localhost:5432/delta_job_tracker}
    username: ${DB_USER:delta}
    password: ${DB_PASSWORD:delta}
    driver-class-name: org.postgresql.Driver

  flyway:
    enabled: true
    locations: classpath:db/migration
    placeholders:
      search_tsv_type: "tsvector"
      search_tsv_generated: "GENERATED ALWAYS AS (to_tsvector('english', coalesce(title,'') || ' ' || coalesce(org_name,'') || ' ' || coalesce(location_text,'') || ' ' || coalesce(employment_type,'') || ' ' || coalesce(description_plain,''))) STORED"
      search_tsv_index: "CREATE INDEX IF NOT EXISTS idx_job_postings_search_tsv ON job_postings USING gin(search_tsv);"

server:
  port: ${PORT:8080}

crawler:
  user-agent: ${CRAWLER_USER_AGENT:delta-job-tracker-bot/0.1}
  per-host-delay-ms: 1000
  global-concurrency: 5
  request-timeout-seconds: 60
  request-max-retries: 2
  request-retry-base-delay-ms: 250
  request-retry-max-delay-ms: 2000
  max-company-seconds: 300
  active-run-minutes: 10
  stale-run-minutes: 10

  daemon:
    enabled: false
    worker-count: 8
    poll-interval-ms: 1000
    lock-ttl-seconds: 600
    success-interval-minutes: 60
    failure-backoff-minutes: [5, 15, 60, 360, 1440]

  # these paths match your repo layout
  data:
    sp500-csv: ../data/sp500_constituents.csv
    domains-csv: ../data/domains.csv

  canary:
    default-limit: 50
    max-duration-seconds: 600
    request-timeout-seconds: 20
    max-requests-per-host: 75
    max-total-requests: 5000
    max-429-rate: 0.08
    min-requests-for-429-rate: 25
    max-consecutive-errors: 25
    max-attempts-per-request: 1
